# 能源演示系统微信小程序开发方案

## 一、项目概述

开发一个微信小程序，实现与现有网页版能源演示系统相同的功能，让用户能够通过手机随时随地查看系统数据，实时监测能源状态。小程序将与后端服务保持WebSocket连接，获取实时数据，并以用户友好的界面进行展示。

## 二、技术架构

### 1. 前端技术栈
- 微信小程序原生开发 (WXML, WXSS, JS)
- ECharts-微信小程序版 (用于图表展示)
- WebSocket (用于实时数据通信)

### 2. 后端技术栈
- 复用现有Node.js后端
- 为小程序添加专用的WebSocket连接处理
- 提供RESTful API接口供小程序调用

### 3. 系统架构图
```
+----------------+     WebSocket     +------------------+
|                |<------------------>|                  |
| 微信小程序客户端 |                     | 现有Node.js后端   |
|                |---RESTful API---->|                  |
+----------------+                   +------------------+
                                           |
                                           | AMQP/MQTT
                                           v
                                    +---------------+
                                    | 能源数据采集设备 |
                                    +---------------+
```

## 三、功能模块设计

### 1. 首页总览
- 系统供电状态卡片
- 电池状态卡片
- 太阳能板卡片
- 天气状况卡片
- 电价信息卡片

### 2. 数据趋势分析
- 能源数据趋势图表
- 电池数据趋势图表
- 太阳能数据趋势图表
- 供电状态趋势图表
- 天气数据趋势图表
- 电价数据趋势图表

### 3. 历史数据查询
- 按日期范围查询历史数据
- 电池数据历史记录
- 太阳能数据历史记录
- 供电状态历史记录
- 天气数据历史记录
- 电价数据历史记录

### 4. 系统设置
- 数据刷新频率设置
- 通知设置
- 主题设置
- 关于系统

## 四、页面设计

### 1. 首页设计
![首页设计](https://placeholder-for-home-page-mockup.png)

- 顶部显示系统标题和连接状态
- 中部展示卡片式数据展示区
- 底部为导航栏

### 2. 数据趋势页设计
![趋势页设计](https://placeholder-for-trend-page-mockup.png)

- 顶部为标签切换栏
- 中部为图表展示区
- 底部为时间范围选择器

### 3. 历史数据页设计
![历史数据页设计](https://placeholder-for-history-page-mockup.png)

- 顶部为日期选择器
- 中部为数据表格
- 底部为导出/分享按钮

### 4. 设置页设计
![设置页设计](https://placeholder-for-settings-page-mockup.png)

- 列表式设置项
- 包含各种配置选项
- 底部显示版本信息

## 五、接口设计

### 1. RESTful API接口

| 接口路径 | 方法 | 描述 |
|---------|------|------|
| /api/wechat/auth | POST | 微信小程序认证 |
| /api/all-latest-data | GET | 获取所有最新数据 |
| /api/battery-data | GET | 获取电池历史数据 |
| /api/solar-data | GET | 获取太阳能历史数据 |
| /api/power-status | GET | 获取供电状态历史数据 |
| /api/weather-data | GET | 获取天气历史数据 |
| /api/electricity-price | GET | 获取电价历史数据 |
| /api/wuhan-weather | GET | 获取武汉实时天气 |
| /api/hubei-electricity-price | GET | 获取湖北省实时电价 |

### 2. WebSocket事件

| 事件名 | 方向 | 描述 |
|--------|------|------|
| connect | 客户端->服务器 | 建立连接 |
| device-data | 服务器->客户端 | 实时设备数据 |
| data-update | 服务器->客户端 | 数据更新 |
| get-historical-data | 客户端->服务器 | 请求历史数据 |
| disconnect | 客户端->服务器 | 断开连接 |

## 六、实现计划

### 第一阶段：基础框架搭建
1. 创建微信小程序项目
2. 设计并实现基本页面结构
3. 配置基础组件和导航

### 第二阶段：接口对接
1. 实现RESTful API调用功能
2. 实现WebSocket连接和事件处理
3. 数据模型设计和实现

### 第三阶段：UI开发和图表集成
1. 实现各个页面的UI组件
2. 集成ECharts图表显示
3. 实现数据表格和历史记录展示

### 第四阶段：功能完善和测试
1. 实现设置页面功能
2. 添加数据导出和分享功能
3. 优化用户体验
4. 全面测试和修复问题

### 第五阶段：发布和迭代
1. 提交微信小程序审核
2. 发布上线
3. 收集用户反馈
4. 持续优化迭代

## 七、项目周期

| 阶段 | 时间预估 | 主要工作 |
|------|---------|---------|
| 第一阶段 | 1周 | 基础框架搭建 |
| 第二阶段 | 1周 | 接口对接 |
| 第三阶段 | 2周 | UI开发和图表集成 |
| 第四阶段 | 1周 | 功能完善和测试 |
| 第五阶段 | 1周 | 发布和迭代 |
| 总计 | 6周 | 完整项目周期 |

## 八、开发注意事项

1. **安全性考虑**：
   - 实现合适的认证机制
   - 使用HTTPS保护数据传输
   - 防止敏感信息泄露

2. **性能优化**：
   - 控制WebSocket连接次数
   - 减少不必要的数据传输
   - 优化图表渲染性能

3. **用户体验**：
   - 确保界面响应迅速
   - 添加加载状态提示
   - 提供错误信息反馈
   - 适配不同尺寸的手机屏幕

4. **兼容性**：
   - 确保在各种微信版本中正常运行
   - 测试在不同手机型号上的表现

5. **持续集成**：
   - 与现有系统保持同步更新
   - 确保API变更时小程序也相应更新 